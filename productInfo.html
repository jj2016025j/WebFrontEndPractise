<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品介紹</title>
    <!-- 引入Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!-- 引入Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet"> 
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;900&family=Open+Sans:ital,wght@1,700&display=swap" rel="stylesheet">
    <!-- 引入手刻 -->
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/global.css">
</head>
<body>
    <header>
        
    </header>
    <main>
        <div class="main-header row">
            <h1 class="h1 open-sans" id="product-name">神奇手錶</h1>
            <div class="row">
                <p class="open-sans" id="product-price">價格: $199.99</p>
                <a href="./shoppingCar.html" class="btn buy-btn-lg" id="buy-botton">購買</a>
            </div>
        </div>
        <div class="row product-info">
            <img src="https://picsum.photos/400/400" alt="商品图片" class="product-image" id="product-image">
            <div class="info row">
                <h1 class="open-sans" id="product-description">這款手錶不僅時尚且功能強大，是您日常生活的完美伴侶。</h1>
                <!-- <button class="buy-btn-sm">購買</button> -->
            </div>
        </div>
        <div class="display" style="height: 50vh;">
            <!-- <h1 class="note-sans-black colorful">產品介紹</h1> -->
        </div>
        <!-- 所有商品 -->
        <div id="all-product-display"></div>
    </main>

    <footer>

    </footer>

    <script>
        //===============生成商品頁面=================
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const productName = decodeURIComponent(urlParams.get('productName'));
            console.log(productName)
            loadProductDetails(productName);
        });

        function loadProductDetails(productName) {
            fetch('./json/data.json')
                .then(response => response.json())
                .then(data => {
                    const product = data.products.find(product => product.name === productName);
                    console.log(product)
                    if (product) {
                        updateProductPage(product);
                    } else {
                        // 找不到商品，重定向到404.html頁面
                        // window.location.href = '404.html';
                        console.log("找不到商品，重定向到404")
                    }
                })
                .catch(error => {
                    // console.error('Error loading product details:', error);
                    console.log(error)
                    // window.location.href = '404.html';
                });
        }

        function updateProductPage(product) {
            document.getElementById('product-name').innerText = product.name;
            document.getElementById('product-price').innerText = `價格: $${product.price}`;
            document.getElementById('product-image').src = product.image;
            document.getElementById('product-description').innerText = product.description; // 假設您的數據中有描述信息
            document.getElementById('buy-botton').href = `./shoppingCar.html`; // 假設您的數據中有描述信息
        }

        //==============加入購物車=================
        document.addEventListener('DOMContentLoaded', () => {
            const buyButton = document.getElementById('buy-botton');
            buyButton.addEventListener('click', addToCart);
        });

        function addToCart(event) {
            event.preventDefault();

            const productName = document.getElementById('product-name').textContent;
            const productAdded = addProductToShoppingCartList(productName);

            if (productAdded) {
                alert('商品已添加到购物车');
            } else {
                alert('购物车已有此商品');
            }
                    
            // 假设这里是计算小计、运费、税款和总金额的逻辑
            let subtotal = calculateSubtotal(); // 计算小计
            let shipping = calculateShipping(); // 计算运费
            let tax = calculateTax(subtotal); // 计算税款
            let total = subtotal + shipping + tax; // 计算总金额

            // 将订单摘要信息存储到localStorage
            const orderSummary = {
                subtotal: subtotal,
                shipping: shipping,
                tax: tax,
                total: total
            };
            localStorage.setItem('orderSummary', JSON.stringify(orderSummary));

            window.location.href = './shoppingCar.html';
        }

        function addProductToShoppingCartList(productName) {
            let shoppingCartList = JSON.parse(localStorage.getItem('shoppingCartList')) || [];
            
            // 检查购物车中是否已存在该商品名称
            const productExists = shoppingCartList.includes(productName);

            if (!productExists) {
                shoppingCartList.push(productName);
                localStorage.setItem('shoppingCartList', JSON.stringify(shoppingCartList));
                return true; // 商品成功添加到购物车
            }
            return false; // 购物车已有此商品
        }
        
        
        // 示例计算函数（根据您的实际业务逻辑进行调整）
        function calculateSubtotal() {
            // 计算小计的逻辑...
            return 20; // 示例返回值
        }

        function calculateShipping() {
            // 计算运费的逻辑...
            return 5; // 示例返回值
        }

        function calculateTax(subtotal) {
            // 计算税款的逻辑...
            return subtotal * 0.1; // 示例：税率10%
        }

    </script>
    <script src="./javascript/joinHeaderFooter.js"></script>
    <script src="./javascript/data.js"></script>
    <!-- 引入Bootstrap JavaScript（可選） -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>
</html>
